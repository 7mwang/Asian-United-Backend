<html>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<head>
<link rel="stylesheet" href="/static/cookiestyle.css">  
</head>
<script>
var count = 0;
var rate = 1;
var cost = 100;
var clickerCost = 1000;
var clickerCount = 0;
var plusCount = 0;
async function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
   }
async function clickers() {
    while (true) {
        await sleep(1000);
        console.log("working")
        count = count + (rate*clickerCount);
        document.getElementById("cookieDisplay").innerHTML = count + " Alex Coins";
    }   
}
function addGen(){
    if (count >= cost){
        count = count 
        cost +=100
        plusCount +=1
        rate +=1
        document.getElementById("xplusCount").innerHTML = "x" + plusCount;
        document.getElementById("cookieDisplay").innerHTML = count + " Alex Coins";
        document.getElementById("newCost").innerHTML = "Next increase: " + cost;
    }
    
    else {
        document.getElementById("buy1").animate(
            [
                { background: '#ff0000'}
            ] , {
                duration: 20
            }
        )
    }
    }
function swapper(){
    count = count + rate
    document.getElementById("cookieDisplay").innerHTML = count + " Alex Coins";
}
function buyClicker(){
    if (count >= clickerCost){
        count = count - clickerCost;
        clickerCost +=1000;
        clickerCount +=1;
        document.getElementById("xclickerCount").innerHTML = "x" + clickerCount;
        document.getElementById("cookieDisplay").innerHTML = count + " Alex Coins";
        document.getElementById("newClicker").innerHTML = "Next increase: " + clickerCost;
    }
    
    else {
        document.getElementById("buy2").animate(
            [
                { background: '#ff0000'}
            ] , {
                duration: 20
            }
        )
    }
}
function  dev(){
    count = 10000000000
}

clickers();
</script>
<body style = "height: 500vh">
<center><p id = "cookieDisplay" class = "cookieDisplay">Hello! Click the cookie to get coins!</p></center>
<img src="/static/assets/alex.png" onclick="swapper()" class = "cookie">
<button onclick = "addGen()" id = "buy1"><img src = "/static/assets/plus.png" class = "icon"><p id = xplusCount></p></button>
<p id = newCost></p>
<p id = "costMsg"></p>
<p>Increases your <br>coins' per click!</p>
<button onclick = "buyClicker()" id = "buy2"><img src = "/static/assets/autoclicker.png" class = "icon"><p id = xclickerCount></p></button>
<p id = "clickercostMsg"></p>
<p id = "newClicker"></p>
<p>Auto Clicker: <br>Clicks 1 time for you every second</p>
<br><br>
</body>
<br><br>
<button onclick = "dev()">dev butotn</button>
<center><p id = "joke" class = "joke"></p></center>
</html>     


</html>

<script>
  // Define the API URL
  const apiUrl = 'http://127.0.0.1:8640/api/jokes'; // Update this URL to match your server's address

  const fetchedJokes = [];
  const maxJokes = 10; // Number of jokes to fetch initially

  // Function to fetch a fixed number of jokes and store them
  async function fetchInitialJokes() {
    for (let i = 0; i < maxJokes; i++) {
      const randomJoke = await fetchRandomJoke();
      fetchedJokes.push(randomJoke);
    }
  }

  // Function to fetch a random joke
  async function fetchRandomJoke() {
    try {
      const response = await fetch(apiUrl + '/random');
      if (response.ok) {
        const randomJoke = await response.json();
        return randomJoke;
      } else {
        console.error('Request failed with status:', response.status);
        return 'Failed to fetch a joke'; // Return an error message
      }
    } catch (error) {
      console.error('Error:', error);
      return 'Error fetching a joke'; // Return an error message
    }
  }

  async function updateJokeElement() {
    const jokeElement = document.getElementById("joke");

    if (fetchedJokes.length === 0) {
      // Refill the array if it's empty
      await fetchInitialJokes();
    }

    // Get and display the next joke from the array
    const randomJoke = fetchedJokes.shift();
    jokeElement.innerHTML = randomJoke;
  }

  // Function to fetch and update the joke element in a loop
  async function loopJoke() {
    while (true) {
      await updateJokeElement();
      await sleep(3000); // Sleep for 3 seconds (adjust the delay as needed)
    }
  }

  // Call the function to update the joke element after a brief delay
  setTimeout(updateJokeElement, 0);
  loopJoke();
</script>
